<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TPAC 2025 Kobe Food & Attractions Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <!-- Papa Parse for CSV parsing -->
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #1558d6 0%, #681da8 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.2em;
            font-weight: 600;
        }
        
        .header p {
            margin: 0;
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .map-container {
            height: 600px;
            position: relative;
        }
        
        #map {
            height: 100%;
            width: 100%;
        }
        
        .legend {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }
        
        .legend h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.2em;
        }
        
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .legend-marker {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .venue { background-color: #dc3545; }
        .kobe-beef { background-color: #8B4513; }
        .ramen { background-color: #FFA500; }
        .coffee-shop { background-color: #6F4E37; }
        .sake-bar { background-color: #9932CC; }
        .british-pub { background-color: #006400; }
        .italian-restaurant { background-color: #228B22; }
        .italian-pizza { background-color: #32CD32; }
        .attraction { background-color: #1558d6; }
        .park { background-color: #228B22; }
        .district { background-color: #4169E1; }
        
        .footer {
            padding: 20px 30px;
            text-align: center;
            color: #666;
            border-top: 1px solid #e9ecef;
        }
        
        .footer a {
            color: #1558d6;
            text-decoration: none;
        }
        
        .popup-content h4 {
            margin: 0 0 8px 0;
            color: #333;
        }
        
        .popup-content .category {
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            color: #666;
            margin-bottom: 8px;
            display: inline-block;
        }
        
        .popup-content .description {
            margin: 8px 0;
            line-height: 1.4;
        }
        
        .popup-content .tips {
            font-style: italic;
            color: #666;
            font-size: 0.9em;
            margin-top: 8px;
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }
            .header h1 {
                font-size: 1.8em;
            }
            .map-container {
                height: 500px;
            }
            .legend {
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üóæ TPAC 2025 Kobe Food & Attractions</h1>
            <p>Interactive map of restaurants, coffee shops, and sights near Kobe International Conference Center</p>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
        </div>
        
        <div class="legend">
            <h3>üìç Location Categories</h3>
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-marker venue"></div>
                    <span>Conference Venue</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker kobe-beef"></div>
                    <span>Kobe Beef Restaurants</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker ramen"></div>
                    <span>Ramen Shops</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker coffee-shop"></div>
                    <span>Coffee Shops</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker sake-bar"></div>
                    <span>Sake Bars</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker british-pub"></div>
                    <span>British Pubs</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker italian-restaurant"></div>
                    <span>Italian Restaurants</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker italian-pizza"></div>
                    <span>Pizza Places</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker attraction"></div>
                    <span>Attractions</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker park"></div>
                    <span>Parks</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker district"></div>
                    <span>Districts</span>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>
                üìñ <a href="https://github.com/mgifford/Food-W3C-Kobe" target="_blank" rel="noopener">View full food guide on GitHub</a> | 
                üçú <a href="https://www.w3.org/2025/11/TPAC/" target="_blank" rel="noopener">W3C TPAC 2025</a> |
                üóæ November 10-14, 2025 in Kobe, Japan
            </p>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <script>
        // Initialize the map centered on Kobe International Conference Center
        const map = L.map('map').setView([34.6584, 135.2233], 13);

        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        }).addTo(map);

        // Color mapping for different categories
        const categoryColors = {
            'Conference Venue': '#dc3545',
            'Kobe Beef': '#8B4513',
            'Ramen': '#FFA500',
            'Coffee Shop': '#6F4E37',
            'Sake Bar': '#9932CC',
            'British Pub': '#006400',
            'Italian Restaurant': '#228B22',
            'Italian Pizza': '#32CD32',
            'Attraction': '#1558d6',
            'Park': '#228B22',
            'District': '#4169E1',
            'Historic Attraction': '#4169E1'
        };

        // Function to get marker color based on category
        function getMarkerColor(category) {
            return categoryColors[category] || '#666666';
        }

        // Function to create custom marker
        function createCustomMarker(lat, lng, color, isVenue = false) {
            const size = isVenue ? 15 : 10;
            const html = `<div style="
                background-color: ${color};
                width: ${size * 2}px;
                height: ${size * 2}px;
                border-radius: 50%;
                border: 3px solid white;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: ${size}px;
                color: white;
                font-weight: bold;
            ">${isVenue ? 'üè¢' : ''}</div>`;
            
            return L.divIcon({
                html: html,
                className: 'custom-marker',
                iconSize: [size * 2, size * 2],
                iconAnchor: [size, size],
                popupAnchor: [0, -size]
            });
        }

        // Function to create popup content
        function createPopupContent(place) {
            return `
                <div class="popup-content">
                    <h4>${place.Name}</h4>
                    <div class="category">${place.Category}</div>
                    <div class="description"><strong>üìç ${place.Neighborhood}</strong><br>
                    ${place['Why it is good']}</div>
                    <div class="tips"><strong>üí° Tips:</strong> ${place.Tips}</div>
                    ${place['Google Maps'] ? `<br><a href="${place['Google Maps']}" target="_blank">üó∫Ô∏è View on Google Maps</a>` : ''}
                </div>
            `;
        }

        // Load and parse CSV data
        fetch('data/places_with_coords.csv')
            .then(response => response.text())
            .then(csvText => {
                Papa.parse(csvText, {
                    header: true,
                    complete: function(results) {
                        const places = results.data;
                        
                        places.forEach(place => {
                            if (place.Latitude && place.Longitude) {
                                const lat = parseFloat(place.Latitude);
                                const lng = parseFloat(place.Longitude);
                                const color = getMarkerColor(place.Category);
                                const isVenue = place.Category === 'Conference Venue';
                                
                                const marker = L.marker([lat, lng], {
                                    icon: createCustomMarker(lat, lng, color, isVenue)
                                }).addTo(map);
                                
                                marker.bindPopup(createPopupContent(place), {
                                    maxWidth: 300,
                                    className: 'custom-popup'
                                });
                            }
                        });
                    }
                });
            })
            .catch(error => {
                console.error('Error loading CSV data:', error);
                // Fallback: add just the conference center marker
                const venueMarker = L.marker([34.6584, 135.2233], {
                    icon: createCustomMarker(34.6584, 135.2233, '#dc3545', true)
                }).addTo(map);
                
                venueMarker.bindPopup(`
                    <div class="popup-content">
                        <h4>Kobe International Conference Center</h4>
                        <div class="category">Conference Venue</div>
                        <div class="description">W3C TPAC 2025 conference location</div>
                    </div>
                `);
            });
    </script>
</body>
</html>